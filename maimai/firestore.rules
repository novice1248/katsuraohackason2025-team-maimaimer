rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function isAdmin() {
      return request.auth.token.admin == true;
    }

    // フォーム構造を定義するplacesコレクションのルール
    match /places/{placeId} {
      // ログインしているユーザーはフォーム構造を読み取れる
      allow read: if request.auth != null;
      // フォーム構造の変更は管理者のみ許可
      allow write: if isAdmin();

      // categoriesサブコレクションのルール
      match /categories/{categoryId} {
        allow read: if request.auth != null;
        allow write: if isAdmin();

        // itemsサブコレクションのルール
        match /items/{itemId} {
          allow read: if request.auth != null;
          allow write: if isAdmin();
        }
      }
    }
  }
}
